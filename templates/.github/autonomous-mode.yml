# Autonomous Mode Configuration
# Controls agent behavior in YOLO mode
# Reference: AGENTS.md â†’ Security Architecture (4-Layer Model)

autonomous:
  # Kill switch - set to false to pause all autonomous operations
  enabled: true
  
  # Default execution mode
  # - standard: Pause for confirmation at critical points
  # - yolo: Execute entire workflow without stopping
  default_mode: standard

# Layer 1: Actor Allowlist
# Only these actors can perform auto-merge operations
allowed_actors:
  - "copilot[bot]"
  - "github-actions[bot]"
  # Add your GitHub username below:
  # - "your-username"

# Layer 2: Protected Paths
# Changes to these paths ALWAYS require human review
protected_paths:
  # CI/CD and workflow files
  - ".github/workflows/**"
  - ".github/actions/**"
  
  # Secrets and configuration
  - "**/secrets.*"
  - "**/*.env"
  - "**/*.env.*"
  - "**/appsettings.*.json"
  - "**/appsettings.Production.json"
  
  # Package management (supply chain security)
  - "package.json"
  - "package-lock.json"
  - "yarn.lock"
  - "pnpm-lock.yaml"
  - "*.csproj"
  - "*.sln"
  - "requirements.txt"
  - "Pipfile.lock"
  - "poetry.lock"
  
  # Infrastructure
  - "**/terraform/**"
  - "**/bicep/**"
  - "**/cloudformation/**"
  - "Dockerfile*"
  - "docker-compose*.yml"

# Layer 3: Iteration Limits
# Prevents infinite loops in autonomous mode
iteration_limits:
  # Maximum iterations for a single task
  task: 15
  
  # Maximum attempts to fix a bug
  bugfix: 5
  
  # Maximum test retry attempts
  test_retry: 3
  
  # Maximum deployment retry attempts
  deploy_retry: 2

# Layer 4: Command Safety
commands:
  # Auto-approved commands (safe to run without confirmation)
  allowed:
    - "git add"
    - "git commit"
    - "git push"
    - "git pull"
    - "git fetch"
    - "git checkout"
    - "git branch"
    - "git status"
    - "git log"
    - "git diff"
    - "npm test"
    - "npm run build"
    - "npm run lint"
    - "npm install"
    - "npm ci"
    - "dotnet build"
    - "dotnet test"
    - "dotnet run"
    - "dotnet restore"
    - "python -m pytest"
    - "pip install"
    - "ruff check"
    - "ruff format"
  
  # Blocked commands (NEVER run, even in YOLO mode)
  blocked:
    # Destructive file operations
    - "rm -rf"
    - "rm -r"
    - "del /s /q"
    - "rmdir /s /q"
    
    # Destructive git operations
    - "git reset --hard"
    - "git clean -fd"
    - "git push --force"
    - "git push -f"
    
    # Process termination
    - "kill"
    - "pkill"
    - "taskkill"
    
    # Dangerous permissions
    - "chmod 777"
    - "icacls /grant Everyone"
    
    # Database destruction
    - "drop database"
    - "drop table"
    - "truncate table"
    
    # Remote code execution
    - "curl | bash"
    - "curl | sh"
    - "wget | bash"
    - "Invoke-Expression"
    - "iex"

# Quality Gates
# All must pass before deployment in YOLO mode
quality_gates:
  # Require tests to pass
  tests_required: true
  
  # Minimum test coverage percentage
  min_coverage: 80
  
  # Require linting to pass
  lint_required: true
  
  # Require security scan to pass
  security_scan_required: true
  
  # Require build to succeed
  build_required: true

# Deployment Settings
deployment:
  # Auto-deploy to staging in YOLO mode
  auto_staging: true
  
  # NEVER auto-deploy to production (requires explicit approval)
  auto_production: false
  
  # Required approvers for production deployment
  production_approvers:
    - "team-lead"
    - "devops"

# Audit Trail
audit:
  # Create GitHub Issues for all autonomous decisions
  create_issues: true
  
  # Add comments to PRs documenting actions taken
  pr_comments: true
  
  # Log all commands executed
  log_commands: true

